<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MS PG Gen</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script type="text/javascript">
        // Obtain a reference to the platformClient object
        const platformClient = require('platformClient');
        const clientId = "4a707f1e-1ced-4dba-9c0d-9d1055addbdc";
        const redirectUri = "https://scotta1990.github.io/pg-genesys-pages.github.io/"

        let conversationApiInstance = new platformClient.ConversationsApi();

        function getEmailConversationById(conversationId) {
            conversationApiInstance.getConversationsEmailMessages(conversationId).then((data) => {
                console.log(data);
                return data
            });
        }

        function getMessageById(conversationId, messageId) {
             conversationApiInstance.getConversationsEmailMessage(conversationId, messageId).then((data)=> {

             })
        }

        function getLastMessagesN(count=5) {
            const conversationId  = document.getElementById("conversationId").value;
            const conversation = getEmailConversationById(conversationId)["entities"];
            conversation.slice(0, count-1).map((message) => {
                console.log(message["id"])
            }) 
        }

        const client = platformClient.ApiClient.instance;
        client.setEnvironment(platformClient.PureCloudRegionHosts.eu_west_2)
        client.loginImplicitGrant(clientId, redirectUri).then((data) => {
            console.log(data);
            
        }).catch((err) => {
            // Handle failure response
            console.log(err);
        });


      </script>
</head>
<body>
    <h1>MS PG Genesys</h1>
    <input type="text" id="conversationId">
    <button onclick="getLastMessagesN(5)" class="btn btn-default">Test</button>
    <a onclick="getLastMessagesN(5)"></a>

</body>

</html>